<!DOCTYPE HTML>
<html>
  <head>
    <meta charset="utf-8"/>
    <title>Stats</title>
  </head>
  <body>
    <a href="index.html">Home</a>
    <div class="sort">
      <h3>Sort Stats</h3>
      <button id="mp">Most played</button>
      <button id="mg">Most grabbed</button>
      <button id="hp">Hot plays</button>
    </div>
    <pre class="content">
      Loading..
    </pre>
  </body>
  <script>
    var content = document.querySelector(".content");
    var sort = document.querySelector(".sort");
    var mp = document.getElementById("mp");
    var mg = document.getElementById("mg");
    var hp = document.getElementById("hp");
    sort.style.display = "none";
    var stats;
    var client = new XMLHttpRequest();
    client.open('Get', './stats.json');
    client.onreadystatechange = function() {
      content.innerText = "";
      stats = JSON.parse(client.responseText);
      
      for(stat in stats) {
        content.append(JSON.stringify(stat, null, 2));
      }
      
      sort.style.display = "block";
    }
    client.send();
    
    mp.addEventListener("click", function() {
      var topPlayedKeys = Object.keys(stats).sort((a, b) => {
          return stats[b].count - stats[a].count
      })
      var final = {};
      for(x = 0; x < topPlayedKeys.length; x++) {
        final[topPlayedKeys[x]] = stats[topPlayedKeys[x]];
      }
      content.innerText = "";
      content.append(JSON.stringify(final, null, 2));
    });

    mg.addEventListener("click", function() {
      var topGrabbedKeys = Object.keys(stats).sort((a, b) => {
          return stats[b].totalGrabs - stats[a].totalGrabs
      })
      var final = {};
      for(x = 0; x < topGrabbedKeys.length; x++) {
        final[topGrabbedKeys[x]] = stats[topGrabbedKeys[x]];
      }
      content.innerText = "";
      content.append(JSON.stringify(final, null, 2));
    });

    hp.addEventListener("click", function() {
      let topHotPlayedKeys = Object.keys(stats).sort((a, b) => {
          return stats[b].mostGrabs - stats[a].mostGrabs
      })

      var final = {};
      for(x = 0; x < topHotPlayedKeys.length; x++) {
        final[topHotPlayedKeys[x]] = stats[topHotPlayedKeys[x]];
      }
      content.innerText = "";
      content.append(JSON.stringify(final, null, 2));
    })
  </script>
</html>